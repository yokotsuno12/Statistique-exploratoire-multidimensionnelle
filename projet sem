libname projet "/home/u59481623/projet";

/* PROJET SEM - Chaima Abdellali; Léo Déchaumet; Pépita Kenesi Laurent - */



/* Question 1 : On importe les données */
/*PROC IMPORT file = "/home/u59521311/projet final/don2.sas7bdat" out = projet.don dbms=tab ;
run;

PROC IMPORT file = "/home/u59521311/projet final/log.sas7bdat" out = projet.log dbms=tab ;
run;*/ /*Remarque : c'est la transposée de projet.don*/ 

/* On prépare les formats pour la question 2*/

data projet.don3;
set projet.don2;
if item=. then newid = var; else newid = CATX('_' , var,item);
drop var;
drop item;
run;

proc transpose data=projet.don3 out=projet.don2_transpose(drop=_name_);
by nuq;
id newid;
run;

proc format;
	value rdeux 1="Male" 2="Female";
run;

proc format;
	value rcinq 1="Never" 2="Less often" 3="Once every 4 to 6 months"
	4="Once every 2 or 3 months" 5="1 to 3 times per month"
	6="1 to 4 times per week" 7="Almost every day or more often";
run;

/* Questions 2 et 3 : On modifie les formats et on ajoute la variable tranche_age dans le data */
data projet.don_formated ;
format r2 rdeux. ; 
format r5 rcinq. ;
set projet.don2_transpose;
length tranche_age $5;
select ; 
when (r3<35) tranche_age="20-34";
when (34<r3 and r3<50) tranche_age="35-49";
otherwise tranche_age="50-65"; 
end; 
run;

/*Question 4*/

/*Répartition de l'échantillon en age : */
proc sgplot data=projet.don_formated;
   histogram r3;
   title "Répartition selon l'age";
run;


/*Répartition de l'échantillon selon le sexe*/
proc sgplot data=projet.don_formated;
   histogram r2;
   title "Répartition selon le sexe";
run;

/*Répartition de l'échantillon selon le revenu annuel*/

proc sgplot data=projet.don_formated;
   histogram r12;
   title "Répartition selon le revenu annuel";
run;

/*Répartition de l'échantillon selon le statut marital*/

proc sgplot data=projet.don_formated;
   histogram r13;
   title "Répartition selon le statut marital";
run;

/*Répartition de l'échantillon selon la présence d'enfants*/

proc sgplot data=projet.don_formated;
   histogram r14;
   title "Répartition selon la présence d'enfants";
run;

/*Question 5*/

proc sgplot data=projet.don_formated;
histogram R2;
title "repartition homme femme";
run;

proc freq data=projet.don_formated;
tables r2 * cognac / cellchi2 chisq nocol nofreq;
run;
/*a. Les hommes et les femmes consomment-ils de la même façon du cognac ?
Réponse : On remarque que les hommes consomment en moyenne plus souvent du cognac que les femmes: 
On a environ 49 % de réponses positives chez les hommes et 45% de réponses positives chez les femmes. 
Donc environ 4% d'écart : mais est-ce représentatif ? On a 26.14 % de femmes sur 264 personnes qui ont répondu au questionnaire, ce qui représente 69 personnes. */

proc freq data=projet.don_formated;
tables tranche_age * cognac / cellchi2 chisq nocol nofreq;
run;

/*proc format;
value prob_achat 1=0 2=0 3=0 4=0.7 5=1;
run;*/

data projet.don_freq;
set projet.don_formated;
array produit ia1_2 -- ia1_37;
do over produit;
select (produit);
	when(1,2,3) produit = 0;
	when(4) produit = 0.7;
	when(5) produit = 1;
	otherwise;
end;
end;
run;

data projet.don_ia1 (keep=ia1_:);
set projet.don_freq;
run;

proc factor data=projet.don_ia1 R=V plots=all plot;
/* On retient 6 axes, car ce sont les seul qui possèdent une valeur propre supérieur à 1.*/

/*on choisi 6 variables*/
proc factor data=projet.don_ia1 r=v n=6 out=projet.pca plots=all;
/*On a 6 facteurs correspondant à 6 groupes de produit. Le diagramme de corrélation
nous montre le degrés d'appartenance de chaque variable à un groupe. Par exemple, le facteur
1 est corrélé à toutes les variables, donc tous les produit appartiennent au groupe 1.*/

data projet.don_groupes;
set projet.don_freq;
/*Proba_F1 = (ia1_2 + ia1_3 + ia1_4 + ia1_5 + ia1_6 + ia1_7 + ia1_8 + ia1_9 + ia1_10 + ia1_11 + ia1_15 + ia1_17 + ia1_18 + ia1_19)/14;
Proba_F2 = (ia1_21 + ia1_22 + ia1_23)/3;
Proba_F3 = (ia1_24 + ia1_25)/2;
Proba_F4 = (ia1_30 + ia1_31)/2;
Proba_F5 = (ia1_33 + ia1_34 + ia1_35)/3;
Proba_F6 = (ia1_36 + ia1_37)/2;*/

Proba_F1 = mean(ia1_2, ia1_3, ia1_4, ia1_5, ia1_6, ia1_7, ia1_8, ia1_9, ia1_10, ia1_11, ia1_15, ia1_17, ia1_18, ia1_19);
Proba_F2 = mean(ia1_21, ia1_22, ia1_23);
Proba_F3 = mean(ia1_24, ia1_25);
Proba_F4 = mean(ia1_30, ia1_31);
Proba_F5 = mean(ia1_33, ia1_34, ia1_35);
Proba_F6 = mean(ia1_36, ia1_37);
run;

proc sort data=projet.don_groupes;
by tranche_age r2;
run;

/*B.7*/
proc means data=projet.don_groupes mean ;
var Proba_F:;
by tranche_age r2;
run;

/*C.1*/
proc cluster data=projet.don_groupes method=ward ccc pseudo outtree=projet.tree;
var Proba_F:;
id nuq;
run;

/*C.3*/
proc tree data = projet.tree NCL = 5 out = projet.classes ;
run ;

/*C.3.a*/
proc freq data=projet.classes;
table clusname;
run;

/*proc sort data=projet.don_groupes;
    by id_;
run;
 
proc sort data=projet.classes;
    by _ID;
run;*/


data projet.don_cluster;
merge projet.don_groupes projet.classes;
run;

/*C.3.b
On veut comprendre la dépendence entre la variable clusname (qualitative) et les variable Proba_F{1-6} (qualitative).
On calcule cette dépendance avec ANOVA*/
proc anova data=projet.don_cluster;
class clusname;
model Proba_F: = clusname;
run;

/*C.3.c
Ici on veut calculer une dépendance entre des paires de variables qualitative.
On utilise donc des test chi-square.*/

proc freq data=projet.don_cluster;
tables r2*clusname / chisq;
run;

proc freq data=projet.don_cluster;
tables tranche_age*clusname / chisq;
run;

proc freq data=projet.don_cluster;
tables r5*clusname / chisq;
run;

/*C.3.d.i*/
data projet.don_cluster;
set projet.don_cluster;
if us5a_1 = 4 or us5a_1 = 5 then noIce = 1; else noIce = 0;
if us5a_2 = 4 or us5a_2 = 5 then withIce = 1; else withIce = 0;
if us5a_3 = 4 or us5a_3 = 5 then cocktail = 1; else cocktail = 0;
run;

/*C.3.d.ii*/
proc freq data=projet.don_cluster;
tables noIce*clusname / chisq;
run;

proc freq data=projet.don_cluster;
tables withIce*clusname / chisq;
run;

proc freq data=projet.don_cluster;
tables cocktail*clusname / chisq;
run;


